<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LowryBunks - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #4a154b;
            --primary-light: #6d2c70;
            --primary-gradient: linear-gradient(135deg, #4a154b, #7e2987);
            --secondary: #1e88e5;
            --background: #f6f7fb;
            --card-bg: #fff;
            --border-radius: 18px;
            --shadow: 0 4px 24px rgba(80, 80, 120, 0.08);
            --text-main: #23272f;
            --text-muted: #7b7b93;
            --accent: #f2c94c;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
        }
        


        body {
            background: var(--background);
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            color: var(--text-main);
        }
        
        /* Enhanced Admin Header */
        .admin-header {
            background: var(--primary-gradient);
            color: #fff;
            padding: 1.8rem 0;
            margin-bottom: 2.5rem;
            box-shadow: 0 4px 20px rgba(74, 21, 75, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .admin-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            z-index: 0;
        }
        
        .admin-header::after {
            content: '';
            position: absolute;
            bottom: -70%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            z-index: 0;
        }
        
        .admin-header .container-fluid {
            max-width: 1400px;
            position: relative;
            z-index: 1;
        }
        
        .admin-header h2 {
            font-weight: 700;
            letter-spacing: 1px;
            margin: 0;
            position: relative;
        }
        
        .admin-header h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent);
            border-radius: 3px;
        }
        
        .btn-outline-light {
            border-radius: 12px;
            font-weight: 500;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        
        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Enhanced Navigation Pills */
        .nav-pills {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 0.75rem 1.25rem;
            margin-bottom: 2rem;
            display: flex;
            overflow-x: auto;
            gap: 10px;
        }
        
        .nav-pills .nav-link {
            border-radius: 10px;
            padding: 10px 18px;
            font-weight: 500;
            color: var(--text-muted);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link:hover {
            color: var(--primary);
            background-color: rgba(74, 21, 75, 0.05);
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(74, 21, 75, 0.2);
        }
        
        /* Enhanced Cards */
        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(80, 80, 120, 0.12);
        }
        
        .card-header {
            background-color: transparent;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.25rem 1.5rem;
        }
        
        .card-header h5 {
            margin: 0;
            font-weight: 600;
            color: var(--primary);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Enhanced Tables */
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            border-top: none;
            border-bottom-width: 1px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            padding: 1rem 1.25rem;
        }
        
        .table tbody td {
            padding: 1rem 1.25rem;
            vertical-align: middle;
            border-color: rgba(0, 0, 0, 0.05);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(74, 21, 75, 0.02);
        }
        
        /* Enhanced Buttons */
        .btn {
            border-radius: 10px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(74, 21, 75, 0.2);
        }
        
        .btn-success {
            background-color: var(--success);
            border-color: var(--success);
        }
        
        .btn-success:hover {
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }
        
        .btn-warning {
            background-color: var(--warning);
            border-color: var(--warning);
        }
        
        .btn-warning:hover {
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
        }
        
        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
        }
        
        .btn-danger:hover {
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.2);
        }
        
        /* Enhanced Summary Cards */
        .summary-card {
            background: white;
            border-radius: 18px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            height: 100%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(80, 80, 120, 0.12);
        }
        
        .summary-card .icon {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            border-radius: 15px;
        }
        
        .summary-card .users-icon {
            background-color: rgba(74, 21, 75, 0.1);
            color: var(--primary);
        }
        
        .summary-card .attendance-icon {
            background-color: rgba(30, 136, 229, 0.1);
            color: var(--secondary);
        }
        
        .summary-card .subjects-icon {
            background-color: rgba(242, 201, 76, 0.1);
            color: var(--accent);
        }
        
        .summary-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .summary-card p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .summary-card .card-bg {
            position: absolute;
            right: -20px;
            bottom: -20px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            opacity: 0.05;
        }
        
        .summary-card .users-bg {
            background-color: var(--primary);
        }
        
        .summary-card .attendance-bg {
            background-color: var(--secondary);
        }
        
        .summary-card .subjects-bg {
            background-color: var(--accent);
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-container .form-control {
            border-radius: 50px;
            padding: 12px 20px;
            padding-left: 45px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .search-container .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(74, 21, 75, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 12px;
            color: var(--text-muted);
            font-size: 1.1rem;
        }
        
        /* Custom Form Controls */
        .form-control {
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(74, 21, 75, 0.15);
        }
        
        .form-select {
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(74, 21, 75, 0.15);
        }
        
        /* Status Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        .badge-active {
            background-color: rgba(76, 175, 80, 0.15);
            color: var(--success);
        }
        
        .badge-inactive {
            background-color: rgba(244, 67, 54, 0.15);
            color: var(--danger);
        }
        
        #adminDashboard {
            display: none;
        }
    </style>
</head>
<body>
    <script>
        // Ensure we're on the admin page
        if (window.location.pathname !== '/admin.html' && 
            window.location.pathname !== '/admin' && 
            !window.location.pathname.endsWith('/admin.html') && 
            !window.location.pathname.endsWith('/admin')) {
            console.log('Redirecting to admin page...');
            window.location.href = '/admin.html';
        }
    </script>

    <!-- Firebase app error handler -->
    <div id="firebase-error" class="alert alert-danger" style="display:none; position:fixed; top:70px; left:50%; transform:translateX(-50%); z-index:9999; max-width:90%;">
        <h4><i class="fas fa-exclamation-triangle me-2"></i>Firebase Error</h4>
        <p id="firebase-error-message"></p>
        <div id="firebase-error-details" class="mt-2 p-2 bg-light rounded" style="max-height:150px; overflow-y:auto; font-size:0.9em;"></div>
        <button class="btn btn-sm btn-outline-danger mt-2" onclick="this.parentElement.style.display='none'">Dismiss</button>
    </div>
    <div class="admin-header">
        <div class="container-fluid admin-container">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0"><i class="fas fa-user-shield me-2"></i><span class="cursive">Lowry</span>Bunks Admin</h2>
                <button id="logoutBtn" class="btn btn-outline-light"><i class="fas fa-sign-out-alt me-2"></i>Logout</button>
            </div>
        </div>
    </div>
    

    
    <div class="container admin-container">
        <!-- Login Form (shown if not authenticated) -->
        <div id="adminLoginContainer" style="display:none;">
            <div class="card mx-auto" style="max-width: 450px; margin-top: 50px;">
                <div class="card-header text-center">
                    <h4 class="mb-0"><i class="fas fa-lock me-2"></i>Admin Login</h4>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-info">
                        Only administrators can access this page.
                    </div>
                    <div class="mb-3">
                        <label for="adminEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="adminEmail" placeholder="admin@example.com">
                    </div>
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="password">
                    </div>
                    <button id="adminLoginBtn" class="btn btn-primary w-100">Login</button>
                    <div id="loginError" class="mt-3 text-danger" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard (shown if authenticated) -->
        <div id="adminDashboard" style="display:none;">
             <ul class="nav nav-pills" id="admin-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard-content" type="button" role="tab" aria-controls="dashboard-content" aria-selected="true"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-content" type="button" role="tab" aria-controls="users-content" aria-selected="false"><i class="fas fa-users me-2"></i>Users</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="subjects-tab" data-bs-toggle="tab" data-bs-target="#subjects-content" type="button" role="tab" aria-controls="subjects-content" aria-selected="false"><i class="fas fa-book me-2"></i>Subjects</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="userLogs-tab" data-bs-toggle="tab" data-bs-target="#userLogs" type="button" role="tab" aria-controls="userLogs" aria-selected="false"><i class="fas fa-history me-2"></i>User Logs</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications-content" type="button" role="tab" aria-controls="notifications-content" aria-selected="false"><i class="fas fa-bell me-2"></i>Notifications</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="deleted-tab" data-bs-toggle="tab" data-bs-target="#deleted-content" type="button" role="tab" aria-controls="deleted-content" aria-selected="false"><i class="fas fa-trash-alt me-2"></i>Deleted Reports</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance-content" type="button" role="tab" aria-controls="attendance-content" aria-selected="false"><i class="fas fa-calendar-check me-2"></i>Attendance</button>
                </li>
            </ul>

            <div class="tab-content" id="admin-tabs-content">
                <!-- Dashboard Content -->
                <div class="tab-pane fade show active" id="dashboard-content" role="tabpanel" aria-labelledby="dashboard-tab">
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="icon users-icon"><i class="fas fa-users"></i></div>
                                <h3 id="totalUsersStat">0</h3>
                                <p>Total Registered Users</p>
                                <div class="card-bg users-bg"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="icon attendance-icon"><i class="fas fa-chart-pie"></i></div>
                                <h3 id="avgAttendanceStat">0%</h3>
                                <p>Average Attendance Rate</p>
                                <div class="card-bg attendance-bg"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="summary-card">
                                <div class="icon subjects-icon"><i class="fas fa-book"></i></div>
                                <h3 id="totalSubjectsStat">0</h3>
                                <p>Total Active Subjects</p>
                                <div class="card-bg subjects-bg"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Attendance Overview</h5>
                                    <div style="min-height:320px;">
                                        <canvas id="attendanceChart" style="max-height:320px;"></canvas>
                                        <div id="attendanceChartFallback" class="text-center text-muted mt-4" style="display:none;">No attendance data available</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Content -->
                <div class="tab-pane fade" id="users-content" role="tabpanel" aria-labelledby="users-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">All Users</h5>
                            <div>
                                <button id="exportExcelBtn" class="btn btn-sm btn-success me-2">
                                    <i class="fas fa-file-excel me-1"></i> Export to Excel
                                </button>
                                <button id="refreshBtn" class="btn btn-sm btn-outline-light">
                                    <i class="fas fa-sync-alt me-1"></i> Refresh Data
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="spinner" class="spinner-container">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                            <div id="adminTableContainer" class="table-responsive" style="display:none;">
                                <table class="table table-bordered table-hover align-middle" id="adminTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Total Attendance</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Subjects Content -->
                <div class="tab-pane fade" id="subjects-content" role="tabpanel" aria-labelledby="subjects-tab">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Add New Subject</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="subjectName" class="form-label">Subject Name</label>
                                        <input type="text" id="subjectName" class="form-control" placeholder="e.g., Computer Science">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Class Days</label>
                                        <div class="d-flex flex-wrap gap-2">
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Monday" id="monday">
                                                <label class="form-check-label" for="monday">Monday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Tuesday" id="tuesday">
                                                <label class="form-check-label" for="tuesday">Tuesday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Wednesday" id="wednesday">
                                                <label class="form-check-label" for="wednesday">Wednesday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Thursday" id="thursday">
                                                <label class="form-check-label" for="thursday">Thursday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Friday" id="friday">
                                                <label class="form-check-label" for="friday">Friday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Saturday" id="saturday">
                                                <label class="form-check-label" for="saturday">Saturday</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input class-day-checkbox" type="checkbox" value="Sunday" id="sunday">
                                                <label class="form-check-label" for="sunday">Sunday</label>
                                            </div>
                                        </div>
                                        <small class="text-muted">Select the days this subject will be taught</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="classOrder" class="form-label">Class Order</label>
                                        <input type="number" id="classOrder" class="form-control" min="1" placeholder="e.g., 1 for 1st class">
                                        <small class="text-muted">This determines the display order in the user dashboard</small>
                                    </div>
                                    <button id="addSubjectBtn" class="btn btn-primary w-100">
                                        <i class="fas fa-plus-circle me-2"></i>Add Subject
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Existing Subjects</h5>
                                </div>
                                <div class="card-body">
                                    <div id="subjectsSpinner" class="spinner-container" style="display:none;">
                                        <div class="spinner-border text-primary" role="status"></div>
                                    </div>
                                    <ul class="list-group" id="subjectsList"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Logs Tab Content -->
                <div class="tab-pane fade" id="userLogs" role="tabpanel" aria-labelledby="userLogs-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-history me-2"></i>User Activity Logs</h5>
                            <div class="d-flex">
                                <button id="refreshLogsBtn" class="btn btn-sm btn-outline-primary me-2">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh
                                </button>
                                <button id="exportLogsBtn" class="btn btn-sm btn-outline-success me-2">
                                    <i class="fas fa-file-excel me-1"></i>Export Logs
                                </button>
                                <button id="clearLogsBtn" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash me-1"></i>Clear Logs
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-8">
                                    <div class="search-container">
                                        <i class="fas fa-search search-icon"></i>
                                        <input type="text" id="logSearchInput" class="form-control" placeholder="Search logs by name, email, activity...">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select id="logFilterSelect" class="form-select">
                                        <option value="all">All Activities</option>
                                        <option value="login">Login/Logout</option>
                                        <option value="attendance">Attendance</option>
                                        <option value="view">Page Views</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="userLogsTable">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Email</th>
                                            <th>Activity</th>
                                            <th>Timestamp</th>
                                            <th>IP Address</th>
                                            <th>Device</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userLogsBody">
                                        <!-- User logs will be loaded here -->
                                    </tbody>
                                </table>
                                <div id="logsSpinner" class="d-flex justify-content-center align-items-center p-5" style="display: none !important;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Deleted Reports Content -->
                <div class="tab-pane fade" id="deleted-content" role="tabpanel" aria-labelledby="deleted-tab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Deleted Records</h5>
                            <div>
                                <button id="exportDeletedBtn" class="btn btn-sm btn-success me-2">
                                    <i class="fas fa-file-excel me-1"></i> Export Data
                                </button>
                                <button id="refreshDeletedBtn" class="btn btn-sm btn-outline-light">
                                    <i class="fas fa-sync-alt me-1"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="deletedSpinner" class="spinner-container" style="display:none;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover" id="deletedReportsTable">
                                    <thead>
                                        <tr>
                                            <th>Item Type</th>
                                            <th>Original ID</th>
                                            <th>Details</th>
                                            <th>Deleted By</th>
                                            <th>Deleted At</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deletedReportsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications Management Content -->
                <div class="tab-pane fade" id="notifications-content" role="tabpanel" aria-labelledby="notifications-tab">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-bell me-2"></i>All Notifications</h5>
                            <div>
                                <button id="refreshNotificationsBtn" class="btn btn-sm btn-outline-primary me-2">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh
                                </button>
                                <button id="deleteAllNotificationsBtn" class="btn btn-sm btn-outline-danger">
                                    <i class="fas fa-trash me-1"></i>Delete All
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="notificationsSpinner" class="d-flex justify-content-center align-items-center p-5" style="display: none !important;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="notificationsTable">
                                    <thead>
                                        <tr>
                                            <th>Message</th>
                                            <th>Sent By</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Notifications will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-paper-plane me-2"></i>Send New Notification</h5>
                        </div>
                        <div class="card-body">
                            <div id="notification-send-status"></div>
                            <div class="form-group mb-3">
                                <label for="notification-title" class="form-label">Title (Optional)</label>
                                <input type="text" id="notification-title" class="form-control" placeholder="Enter notification title...">
                            </div>
                            <div class="form-group mb-3">
                                <label for="notification-message" class="form-label">Message</label>
                                <textarea id="notification-tab-message" class="form-control" rows="4" placeholder="Type your message here..."></textarea>
                            </div>
                            <button id="send-notification-tab-btn" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-2"></i>Send Notification
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Attendance Management Content -->
                <div class="tab-pane fade" id="attendance-content" role="tabpanel" aria-labelledby="attendance-tab">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Manage Attendance</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="attendanceUserSelect" class="form-label">Select User</label>
                                        <select id="attendanceUserSelect" class="form-select">
                                            <option value="">Loading users...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="attendanceSubjectSelect" class="form-label">Select Subject</label>
                                        <select id="attendanceSubjectSelect" class="form-select">
                                            <option value="">Loading subjects...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="attendanceDate" class="form-label">Date</label>
                                        <input type="date" id="attendanceDate" class="form-control">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Status</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="attendanceStatus" id="statusPresent" value="present" checked>
                                            <label class="form-check-label" for="statusPresent">
                                                Present
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="attendanceStatus" id="statusAbsent" value="absent">
                                            <label class="form-check-label" for="statusAbsent">
                                                Absent
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="attendanceNotes" class="form-label">Notes (Optional)</label>
                                        <textarea id="attendanceNotes" class="form-control" rows="3" placeholder="Add any additional notes here"></textarea>
                                    </div>
                                    <button id="addAttendanceBtn" class="btn btn-primary w-100">
                                        <i class="fas fa-plus-circle me-2"></i>Save Attendance
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Recent Attendance Records</h5>
                                </div>
                                <div class="card-body">
                                    <div id="attendanceSpinner" class="spinner-container" style="display:none;">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover" id="recentAttendanceTable">
                                            <thead>
                                                <tr>
                                                    <th>User</th>
                                                    <th>Subject</th>
                                                    <th>Date</th>
                                                    <th>Status</th>
                                                    <th>Added By</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentAttendanceBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Send Notification -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-bullhorn me-2"></i>Send a Notification</h5>
                            <p class="card-subtitle mb-3 text-muted">Broadcast a message to all users. It will appear on their notifications page.</p>
                            <div id="notification-status"></div>
                            <div class="form-group">
                                <textarea id="notification-message" class="form-control" rows="4" placeholder="Type your message here..."></textarea>
                            </div>
                            <button id="send-notification-btn" class="btn btn-primary mt-3">
                                <i class="fas fa-paper-plane me-2"></i>Send Notification
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>
</div>
    
    <!-- Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="adminToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastBody">Notification</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

     <!-- User Details Modal -->
    <div class="modal fade" id="userDetailsModal" tabindex="-1" aria-labelledby="userDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userDetailsModalLabel">User Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Name:</strong> <span id="modalUserName"></span></p>
                            <p><strong>Email:</strong> <span id="modalUserEmail"></span></p>
                        </div>
                         <div class="col-md-6">
                            <canvas id="userAttendanceChart"></canvas>
                        </div>
                    </div>
                    <hr>
                    <h5>Subject-wise Attendance</h5>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Present</th>
                                <th>Absent</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="modalUserSubjects"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subject Edit Modal -->
    <div class="modal fade" id="editSubjectModal" tabindex="-1" aria-labelledby="editSubjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSubjectModalLabel">Edit Subject</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editSubjectId">
                    <div class="mb-3">
                        <label for="editSubjectName" class="form-label">Subject Name</label>
                        <input type="text" id="editSubjectName" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Class Days</label>
                        <div class="d-flex flex-wrap gap-2">
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Monday" id="editMonday">
                                <label class="form-check-label" for="editMonday">Monday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Tuesday" id="editTuesday">
                                <label class="form-check-label" for="editTuesday">Tuesday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Wednesday" id="editWednesday">
                                <label class="form-check-label" for="editWednesday">Wednesday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Thursday" id="editThursday">
                                <label class="form-check-label" for="editThursday">Thursday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Friday" id="editFriday">
                                <label class="form-check-label" for="editFriday">Friday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Saturday" id="editSaturday">
                                <label class="form-check-label" for="editSaturday">Saturday</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input edit-class-day-checkbox" type="checkbox" value="Sunday" id="editSunday">
                                <label class="form-check-label" for="editSunday">Sunday</label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editClassOrder" class="form-label">Class Order</label>
                        <input type="number" id="editClassOrder" class="form-control" min="1" placeholder="e.g., 1 for 1st class">
                        <small class="text-muted">This determines the display order in the user dashboard</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSubjectChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Attendance Modal -->
    <div class="modal fade" id="editAttendanceModal" tabindex="-1" aria-labelledby="editAttendanceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editAttendanceModalLabel">Edit Attendance Record</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editAttendanceId">
                    <div class="mb-3">
                        <label class="form-label">User</label>
                        <input type="text" id="editAttendanceUser" class="form-control" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Subject</label>
                        <input type="text" id="editAttendanceSubject" class="form-control" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editAttendanceDate" class="form-label">Date</label>
                        <input type="date" id="editAttendanceDate" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="editAttendanceStatus" id="editStatusPresent" value="present">
                            <label class="form-check-label" for="editStatusPresent">
                                Present
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="editAttendanceStatus" id="editStatusAbsent" value="absent">
                            <label class="form-check-label" for="editStatusAbsent">
                                Absent
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editAttendanceNotes" class="form-label">Notes</label>
                        <textarea id="editAttendanceNotes" class="form-control" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveAttendanceChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Deleted Item Details Modal -->
    <div class="modal fade" id="deletedDetailsModal" tabindex="-1" aria-labelledby="deletedDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deletedDetailsTitle">Deleted Item Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="deletedDetailsContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Activity Details Modal -->
    <div class="modal fade" id="activityDetailsModal" tabindex="-1" aria-labelledby="activityDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="activityDetailsTitle">User Activity Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="activityDetailsContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Details Modal -->
    <div class="modal fade" id="notificationDetailsModal" tabindex="-1" aria-labelledby="notificationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="notificationDetailsTitle">Notification Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="notificationDetailsContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger me-2" id="deleteNotificationBtn">Delete</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Excel export libraries -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <!-- Firebase SDK (using compat version for consistency) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container" style="z-index: 1100">
        <!-- Toasts will be appended here -->
    </div>

    <!-- Load auth.js which contains the working Firebase configuration and admin functionality -->
    <script src="auth.js"></script>
    
</body>
</html> 